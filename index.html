

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <base href="/WingStars_Stats/">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>啦啦隊戰績排行榜（正式穩定版 V1.7）</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    th { cursor: pointer; }
    .avatar-placeholder { width: 40px; height: 40px; border-radius: 50%; background-color: #f0f0f0; display: inline-block; }
  </style>
</head>
<body class="p-4">
  <h1 class="mb-4">啦啦隊戰績排行榜（完整穩定版 V1.7）</h1>

  <ul class="nav nav-tabs" id="tabs">
    <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#home" data-type="home">主場戰績</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#away" data-type="away">客場戰績</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#combined" data-type="combined">總戰績</button></li>
  </ul>

  <div class="tab-content mt-3">
    <div class="tab-pane fade show active" id="home"></div>
    <div class="tab-pane fade" id="away"></div>
    <div class="tab-pane fade" id="combined"></div>
  </div>

  <div class="modal fade" id="detailModal" tabindex="-1">
    <div class="modal-dialog"><div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalName">出勤明細</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body"><ul id="modalList" class="list-group"></ul></div>
    </div></div>
  </div>

<script>
let fullData = {};

async function loadData() {
  const res = await fetch('./cheerleader_stats_data.json');
  fullData = await res.json();
  renderCards("home");
}

let sortState = {"combined": null, "home": null, "away": null};

function renderTable(type) {
  let data = [...fullData[type]];
  const container = document.getElementById(type);
  container.innerHTML = `
    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle">
        <thead><tr>
          <th>照片</th>
          <th data-field="name">成員</th>
          <th data-field="total">出賽數</th>
          <th data-field="win">勝場數</th>
          <th data-field="lose">敗場數</th>
          <th data-field="winRate">勝率</th>
          <th data-field="current">目前連勝/敗</th>
          <th>出勤明細</th>
        </tr></thead><tbody></tbody>
      </table>
    </div>`;

  if (sortState[type]) {
    const {field, asc} = sortState[type];
    data.sort((a,b) => {
      let valA = a[field], valB = b[field];
      if (field === 'current') {
        const extract = s => s.includes('連勝') ? parseInt(s) : s.includes('連敗') ? -parseInt(s) : 0;
        valA = extract(valA); valB = extract(valB);
      }
      if (valA === valB) return 0;
      return (valA > valB ? 1 : -1) * (asc ? 1 : -1);
    });
  }

  const tbody = container.querySelector('tbody');
  data.forEach(item=>{
    const row = document.createElement('tr');
    row.innerHTML = `
      <td><div class="avatar-placeholder"></div></td>
      <td>${item.name}</td>
      <td>${item.total}</td>
      <td>${item.win}</td>
      <td>${item.lose}</td>
      <td>${(item.winRate*100).toFixed(1)}%</td>
      <td>${item.current}</td>
      <td><button class='btn btn-sm btn-outline-primary' onclick='showDetail("${item.name}","${type}")'>查看</button></td>`;
    tbody.appendChild(row);
  });

  container.querySelectorAll('th[data-field]').forEach(th=>{
    th.onclick = ()=>{
      const field = th.dataset.field;
      if (sortState[type] && sortState[type].field === field)
        sortState[type].asc = !sortState[type].asc;
      else
        sortState[type] = { field: field, asc: false };
      renderTable(type);
    }
  });
}

function showDetail(name, type) {
  const item = fullData[type].find(d => d.name === name);
  document.getElementById('modalName').innerText = `${item.name} 出勤明細`;
  const ul = document.getElementById('modalList');
  ul.innerHTML = '';
  item.detail.forEach(d => {
    const li = document.createElement('li');
    li.className = 'list-group-item';
    li.innerHTML = `
      日期：${d.date}（${d.weekday_fixed}）<br>
      地點：${d.stadium}<br>
      結果：${d.result}　${d.opponent_fixed} ${d.opp_score} ： ${d.self_score} 啾啾
    `;
    ul.appendChild(li);
  });
  new bootstrap.Modal(document.getElementById('detailModal')).show();
}

// 頁籤切換時重設排序
document.querySelectorAll('#tabs button').forEach(btn => {
  btn.addEventListener('shown.bs.tab', e => {
    const type = e.target.dataset.type;
    sortState[type] = null;
    renderTable(type);
  });
});

['home','away','combined'].forEach(renderTable);
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body></html>
